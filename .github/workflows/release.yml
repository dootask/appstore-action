name: å‘å¸ƒæ’ä»¶åˆ° DooTask åº”ç”¨å•†åº—

on:
  push:
    tags:
      - 'v*'  # å½“æ¨é€ v å¼€å¤´çš„æ ‡ç­¾æ—¶è§¦å‘

jobs:
  release:
    runs-on: ubuntu-latest
    steps:
      - name: æ£€å‡ºä»£ç 
        uses: actions/checkout@v4

      - name: è·å–æ ‡ç­¾ä¿¡æ¯
        id: tag
        run: |
          TAG_NAME=${GITHUB_REF#refs/tags/}
          echo "tag_name=$TAG_NAME" >> $GITHUB_OUTPUT
          echo "å‘å¸ƒæ ‡ç­¾: $TAG_NAME"

      - name: æ‰“åŒ… test_plugin ç›®å½•
        run: |
          tar -czf test-plugin.tar.gz -C test_plugin .
          ls -la test-plugin.tar.gz

      - name: å‘å¸ƒåˆ° DooTask åº”ç”¨å•†åº—
        uses: dootask/appstore-action@v1
        with:
          username: ${{ secrets.DOOTASK_USERNAME }}
          password: ${{ secrets.DOOTASK_PASSWORD }}
          appid: 'test-plugin'
          package_file: './test-plugin.tar.gz'
          draft: false
        id: publish

      - name: è¾“å‡ºå‘å¸ƒç»“æœ
        run: |
          echo "ğŸ‰ æ ‡ç­¾ ${{ steps.tag.outputs.tag_name }} å‘å¸ƒå®Œæˆï¼"
          echo "Token: ${{ steps.publish.outputs.token }}"
          echo "Hash: ${{ steps.publish.outputs.hash }}"
          echo "Success: ${{ steps.publish.outputs.success }}" 